
ECLASS=gnustep
INHERITED="$INHERITED $ECLASS"

inherit patch extrafiles doc-tex

DESCRIPTION="Based on the gnustep eclass."

IUSE="doc"

DEPEND="${DEPEND}"

if [ -z "${GNUSTEP_ROOT}" ]
    then
    GNUSTEP_ROOT=/opt/GNUstep
fi

# source ${GNUSTEP_ROOT}/System/Library/Makefiles/GNUstep.sh

LOGNAME=portage

if [ -f ${GNUSTEP_ROOT}/System/Library/Makefiles/GNUstep.sh ] 
    then
    source ${GNUSTEP_ROOT}/System/Library/Makefiles/GNUstep.sh
else
    die "gnustep-make not installed!"
fi

HOME=${T}
GNUSTEP_USER_ROOT=${T}/GNUstep

mkdir -p ${T}/GNUstep


gnustep_src_compile () 
{
    mkdir -p ${T}/GNUstep
    
    cd ${S}
    
#    unset CFLAGS
#    unset CC

    ./configure \
	HOME=${T} \
	GNUSTEP_USER_ROOT=${T}/GNUstep \
	${myconf} \
	|| die "configure failed"
    
    make \
	HOME=${T} \
	GNUSTEP_USER_ROOT=${T}/GNUstep \
	|| die
	
    if ( use doc )
	then
	cd ${S}/Documentation
	make \
	    HOME=${T} \
	    GNUSTEP_USER_ROOT=${T}/GNUstep \
	    || die
    fi
}

gnustep_src_install () 
{
    cd ${S}

    make \
	GNUSTEP_USER_ROOT=${T}/GNUstep \
	HOME=${T} \
	GNUSTEP_INSTALLATION_DIR=${D}${GNUSTEP_SYSTEM_ROOT} \
	INSTALL_ROOT_DIR=${D} \
	install || die
    
    if ( use doc )
	then
	cd ${S}/Documentation
	make \
	    GNUSTEP_INSTALLATION_DIR=${D}${GNUSTEP_SYSTEM_ROOT} \
	    INSTALL_ROOT_DIR=${D} \
	    install || die
    fi
}

EXPORT_FUNCTIONS src_compile src_install

# Local Variables:
# mode: sh
# End:
