# Copyright 1999-2003 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License v2
# $Header: /home/cvsroot/gentoo-x86/net-www/apache/apache-2.0.44.ebuild,v 1.5 2003/02/23 19:39:22 woodchip Exp $

ECVS_CVS_COMMAND="cvs -q"
ECVS_SERVER="cvs.caudiumforge.net:/cvs/project"
ECVS_USER="anoncvs"
ECVS_AUTH="ext"
ECVS_MODULE="${PN}"
ECVS_BRANCH="stable_1_4"
ECVS_CO_OPTS="-P -D ${PV/*_pre}"
ECVS_UP_OPTS="-dP -D ${PV/*_pre}"
ECVS_TOP_DIR="${DISTDIR}/cvs-src/caudiumforge.net/${PN}"
# ECVS_SSH_HOST_KEY="cvs.caudiumforge.net,193.218.105.22 ssh-dsa MIIBuwIBAAKBgQCIKUfNNJZkrb0/IcvWWfZQu8PAytIqdxn3Bqrc7suVshnhUDuZAZn5GO4mNujBFIiJTn6JNbV8MDDM5BNa65V2A7klf2+MvSPgiM8Ri3bO2TA7cNCI4FjawflyJFycaGq/Wn71t3q4W+zojE3DK1z9gBSFfQl6NBdxet42PO8SkwIVALhQpcqeBxmFGiZ9VQtCxjG8M+HFAoGAaF0eA+Oi3GAUOdaaOEc0FcKzfuQuQCa2crkQ08XbMMOMsNHRmNcSp95Johd9nA0D17GykPOfoaoum6ZKUjTYo8ItxNFL5qJOqxoy2F5tuDWgZvBACLYYYVHsqFpj/jXqDym+1MoVHLc5rjstAkVuvl7hlRuzJUx4EsRJSR1GsbYCgYBQ2CDRdb6voRP8qcx5Je803k7arEFoHw69wya/gSDO8LPTCrUShtbfEHgWT+oXF7hW0LfbdyI3Ho7CMAOi+LhvNZKOhrPRcuiMiMXXu6GDKAgZwnfo/zK13S5DPMayzurcUMJDYU4e2eIC0yROSBTF3FhHXbM1s4GksLb1hRzrCgIVAJ40kz+OkMIBrhos0CtyyOuzVANJ"

IUSE="perl"

inherit eutils gnuconfig cvs

DESCRIPTION="Caudium Web Server"
HOMEPAGE="http://www.caudium.net/"

CVS_REV=""

MY_P=${P}${CVS_REV}

S="${WORKDIR}/${MY_P}"
#SRC_URI="ftp://ftp.caudium.net/caudium/source/${MY_P}.tar.bz2"

LICENSE="GPL-2 | LGPL-2.1 | MPL-1.1"
SLOT="0"
KEYWORDS="x86 amd64"

DEPEND=">=dev-lang/pike-7.6.24
	perl?	>=dev-lang/perl-5.8
	dev-libs/expat
	app-text/sablotron
	dev-libs/openssl"

RDEPEND="${DEPEND}"

#src_unpack() 
#{
#    unpack ${A}
#    cd ${S}
#    sed -i -e "s:CAUDIUM_SERVERDIR="$prefix/caudium/server/::"
#}

src_compile() 
{
    local myconf
    myconf="${myconf} --with-serverdir=/usr/lib/caudium"
    
    cd ${S}
    
    econf \
	${myconf}
    
    emake || die "Compile error"
  
}

src_install () 
{
    addwrite /usr/bin/pike
    addpredict /usr/bin
    
    enewgroup www 412
    enewuser www 412 /bin/false /srv/localhost/www www

    emake install_alt prefix=/usr DESTDIR=${D} 
    
    mv ${D}/usr/share/doc/caudium ${D}/usr/share/doc/${P}
    
    newinitd ${FILESDIR}/caudium.rc caudium
    newconfd ${FILESDIR}/caudium.confd caudium
    
    dodir /var/lib/caudium
    fowners www:www /var/lib/caudium
    keepdir /var/run/caudium  
    fowners www:www /var/run/caudium  
    keepdir /var/log/caudium  
    fowners www:www /var/log/caudium  
    keepdir /var/cache/caudium/argument_cache  
    keepdir /var/cache/caudium/storage
    chown -R www:www ${D}/var/cache/caudium

    insinto /etc/caudium/servers
    doins ${FILESDIR}/Global_Variables    
    chown -R www:www ${D}/etc/caudium
}


pkg_config ()
{
    cd /usr/lib/caudium
    CAUDIUM_VARDIR=/var/lib/caudium \
    ./install \
	--log-dir=/var/log/caudium \
	--config-dir=/etc/caudium/servers \
	--pid-file=/var/run/caudium/caudium.pid 
}

# Local Variables:
# mode: sh
# End:


