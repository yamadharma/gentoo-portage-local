#! /bin/sh
#
# Tiny startup wrapper for Eclipse
#
# Updated by Hanno Meyer-Thurow
#
# Copyright (c) 2004, Karl Trygve Kalleberg <karltk@gentoo.org>
# Copyright (c) 2004, Gentoo Foundation
#
# Licensed under the GNU General Public License, version 2
#

[ -f /etc/eclipserc ] && . /etc/eclipserc
[ -f $HOME/.eclipserc ] && . $HOME/.eclipserc

ECLIPSE_HOME=${ECLIPSE_HOME:="/usr/lib/eclipse-3.4"}
ECLIPSE_BIN="${ECLIPSE_HOME}/eclipse"

if [ ! -x ${ECLIPSE_BIN} ] ; then
	echo "Failed to find executable '${ECLIPSE_BIN}'" > /dev/stderr
	exit -1
fi

if [ $(id -u) -eq 0 ] ; then
	echo "Do not run eclipse as root user! Exitting ..."
	exit -1
fi

[[ "$(java-config -f)" =~ "gcj" ]] \
	&& export JAVA_PKG_CLASSMAP="${ECLIPSE_HOME}/eclipse.gcjdb"

LIBDIR="lib"
[ -d /usr/lib64 ] && LIBDIR="lib64"
[ -f /usr/${LIBDIR}/mozilla-firefox/libgtkembedmoz.so ] \
	&& export MOZILLA_FIVE_HOME="/usr/${LIBDIR}/mozilla-firefox"
[ -f /usr/${LIBDIR}/seamonkey/libgtkembedmoz.so ] \
	&& export MOZILLA_FIVE_HOME="/usr/${LIBDIR}/seamonkey"
[ -f /usr/${LIBDIR}/xulrunner/libgtkembedmoz.so ] \
	&& export MOZILLA_FIVE_HOME="/usr/${LIBDIR}/xulrunner"
[ -d /usr/${LIBDIR}/xulrunner-1.9 ] \
	&& export MOZILLA_FIVE_HOME="/usr/${LIBDIR}/xulrunner-1.9"

[ -n "${ECLIPSE_XMS}" ] && VM_ARGS="${VM_ARGS} -Xms${ECLIPSE_XMS}"
[ -n "${ECLIPSE_XMX}" ] && VM_ARGS="${VM_ARGS} -Xmx${ECLIPSE_XMX}"
[ -n "${ECLIPSE_PERMSIZE}" ] && VM_ARGS="${VM_ARGS} -XX:PermSize=${ECLIPSE_PERMSIZE}"
[ -n "${ECLIPSE_MAX_PERMSIZE}" ] && VM_ARGS="${VM_ARGS} -XX:MaxPermSize=${ECLIPSE_MAX_PERMSIZE}"
 
exec ${ECLIPSE_BIN} -vm $(java-config --java) "$@" -vmargs ${VM_ARGS}
