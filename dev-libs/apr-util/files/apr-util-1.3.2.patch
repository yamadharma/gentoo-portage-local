--- apr-util-1.3.4.ebuild	2008-08-16 19:05:57.000000000 +0200
+++ apr-util-1.3.4-r100.ebuild	2008-08-25 12:35:59.499004133 +0200
@@ -10,8 +10,8 @@
 
 LICENSE="Apache-2.0"
 SLOT="1"
-KEYWORDS="alpha amd64 ~arm hppa ia64 ~mips ppc ppc64 ~s390 ~sh sparc ~sparc-fbsd x86 ~x86-fbsd"
-IUSE="berkdb doc freetds gdbm ldap mysql odbc postgres sqlite sqlite3"
+KEYWORDS="~alpha ~amd64 ~arm ~hppa ~ia64 ~mips ~ppc ~ppc64 ~s390 ~sh ~sparc ~sparc-fbsd ~x86 ~x86-fbsd"
+IUSE="berkdb doc freetds gdbm ldap mozldap mysql odbc postgres sqlite sqlite3"
 RESTRICT="test"
 
 RDEPEND="dev-libs/expat
@@ -20,6 +20,9 @@
 	freetds? ( dev-db/freetds )
 	gdbm? ( sys-libs/gdbm )
 	ldap? ( =net-nds/openldap-2* )
+	mozldap? ( =dev-libs/mozldap-6*
+		  =dev-libs/nspr-4*
+                  =dev-libs/nss-3* )
 	mysql? ( =virtual/mysql-5* )
 	odbc? ( dev-db/unixODBC )
 	postgres? ( virtual/postgresql-base )
@@ -28,11 +31,25 @@
 DEPEND="${RDEPEND}
 	doc? ( app-doc/doxygen )"
 
+src_unpack() {
+	unpack ${A}
+	cd "${S}"
+
+	epatch "${FILESDIR}"/"${PN}"-1.2.10-mozldap60-2.patch
+	eautoconf
+}
+
 src_compile() {
 	local myconf=""
 
 	use ldap && myconf="${myconf} --with-ldap"
 
+	use mozldap && myconf="${myconf} --with-ldap \
+					 --with-ldap-include=/usr/include/mozldap/ \
+					 --with-ldap-lib=/usr/$(get_libdir)/mozldap/ \
+					 --with-nss-lib=/usr/$(get_libdir)/nss/ \
+					 --with-nspr-lib=/usr/$(get_libdir)/nspr"
+
 	if use berkdb; then
 		dbver="$(db_findver sys-libs/db)" || die "Unable to find db version"
 		dbver="$(db_ver_to_slot "$dbver")"
