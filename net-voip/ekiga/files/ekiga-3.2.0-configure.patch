--- configure.old	2009-03-29 14:53:29.000000000 -0400
+++ configure	2009-04-17 21:52:44.000000000 -0400
@@ -1129,6 +1129,8 @@
 AVAHI_LIBS
 GSTREAMER_CFLAGS
 GSTREAMER_LIBS
+KDE_CFLAGS
+KDE_LIBS
 SOUP_CFLAGS
 SOUP_LIBS
 PTLIB_CFLAGS
@@ -1863,6 +1865,8 @@
               C compiler flags for GSTREAMER, overriding pkg-config
   GSTREAMER_LIBS
               linker flags for GSTREAMER, overriding pkg-config
+  KDE_CFLAGS  C compiler flags for KDE, overriding pkg-config
+  KDE_LIBS    linker flags for KDE, overriding pkg-config
   SOUP_CFLAGS C compiler flags for SOUP, overriding pkg-config
   SOUP_LIBS   linker flags for SOUP, overriding pkg-config
   PTLIB_CFLAGS
@@ -5399,7 +5403,7 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 5402 "configure"' > conftest.$ac_ext
+  echo '#line 5406 "configure"' > conftest.$ac_ext
   if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
@@ -8003,11 +8007,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:8006: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:8010: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:8010: \$? = $ac_status" >&5
+   echo "$as_me:8014: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -8293,11 +8297,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:8296: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:8300: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:8300: \$? = $ac_status" >&5
+   echo "$as_me:8304: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -8397,11 +8401,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:8400: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:8404: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:8404: \$? = $ac_status" >&5
+   echo "$as_me:8408: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -10810,7 +10814,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 10813 "configure"
+#line 10817 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10910,7 +10914,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 10913 "configure"
+#line 10917 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -13319,11 +13323,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:13322: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:13326: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:13326: \$? = $ac_status" >&5
+   echo "$as_me:13330: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -13423,11 +13427,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:13426: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:13430: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:13430: \$? = $ac_status" >&5
+   echo "$as_me:13434: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -15021,11 +15025,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:15024: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:15028: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:15028: \$? = $ac_status" >&5
+   echo "$as_me:15032: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -15125,11 +15129,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:15128: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:15132: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:15132: \$? = $ac_status" >&5
+   echo "$as_me:15136: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -17353,11 +17357,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:17356: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:17360: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:17360: \$? = $ac_status" >&5
+   echo "$as_me:17364: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -17643,11 +17647,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:17646: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:17650: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:17650: \$? = $ac_status" >&5
+   echo "$as_me:17654: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -17747,11 +17751,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:17750: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:17754: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:17754: \$? = $ac_status" >&5
+   echo "$as_me:17758: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -25071,7 +25075,9 @@
 
 # Check whether --enable-gstreamer was given.
 if test "${enable_gstreamer+set}" = set; then
-  enableval=$enable_gstreamer; enable_gstreamer=yes
+  enableval=$enable_gstreamer;
+else
+  enable_gstreamer=yes
 fi
 
 
@@ -25220,14 +25226,85 @@
 
 # Check whether --enable-kde was given.
 if test "${enable_kde+set}" = set; then
-  enableval=$enable_kde; enable_kde=yes
+  enableval=$enable_kde;
+else
+  enable_kde=yes
 fi
 
 
 if test "x$enable_kde" = "xyes"; then
-  found_kde=yes
-  KDE_CFLAGS="-I/usr/include/qt4"
-  KDE_LIBS="-lQtCore"
+
+pkg_failed=no
+{ $as_echo "$as_me:$LINENO: checking for KDE" >&5
+$as_echo_n "checking for KDE... " >&6; }
+
+if test -n "$PKG_CONFIG"; then
+    if test -n "$KDE_CFLAGS"; then
+        pkg_cv_KDE_CFLAGS="$KDE_CFLAGS"
+    else
+        if test -n "$PKG_CONFIG" && \
+    { ($as_echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"QtCore\"") >&5
+  ($PKG_CONFIG --exists --print-errors "QtCore") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  pkg_cv_KDE_CFLAGS=`$PKG_CONFIG --cflags "QtCore" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+    fi
+else
+	pkg_failed=untried
+fi
+if test -n "$PKG_CONFIG"; then
+    if test -n "$KDE_LIBS"; then
+        pkg_cv_KDE_LIBS="$KDE_LIBS"
+    else
+        if test -n "$PKG_CONFIG" && \
+    { ($as_echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"QtCore\"") >&5
+  ($PKG_CONFIG --exists --print-errors "QtCore") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  pkg_cv_KDE_LIBS=`$PKG_CONFIG --libs "QtCore" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+    fi
+else
+	pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        KDE_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "QtCore"`
+        else
+	        KDE_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "QtCore"`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$KDE_PKG_ERRORS" >&5
+
+	{ $as_echo "$as_me:$LINENO: result: no" >&5
+$as_echo "no" >&6; }
+                found_kde=no
+elif test $pkg_failed = untried; then
+	found_kde=no
+else
+	KDE_CFLAGS=$pkg_cv_KDE_CFLAGS
+	KDE_LIBS=$pkg_cv_KDE_LIBS
+        { $as_echo "$as_me:$LINENO: result: yes" >&5
+$as_echo "yes" >&6; }
+	found_kde=yes
+fi
+
   CPPFLAGS_save="$CPPFLAGS"
   LIBS_save="$LIBS"
   CPPFLAGS="$CPPFLAGS $KDE_CFLAGS"
@@ -25379,6 +25456,9 @@
    { (exit 1); exit 1; }; }
   fi
 
+  KDE_LIBS="$KDE_LIBS -lkdeui"
+
+
 
   KDE="enabled"
 
@@ -25401,7 +25481,9 @@
 
 # Check whether --enable-kab was given.
 if test "${enable_kab+set}" = set; then
-  enableval=$enable_kab; enable_kab=yes
+  enableval=$enable_kab;
+else
+  enable_kab=yes
 fi
 
 
@@ -25414,7 +25496,7 @@
   fi
   found_kab=yes
   KAB_CFLAGS="-I/usr/include/qt4"
-  KAB_LIBS="-lQtCore -lkabc"
+  KAB_LIBS="-lkabc"
   CPPFLAGS_save="$CPPFLAGS"
   LIBS_save="$LIBS"
   CPPFLAGS="$CPPFLAGS $KAB_CFLAGS"
@@ -25588,7 +25670,9 @@
 
 # Check whether --enable-xcap was given.
 if test "${enable_xcap+set}" = set; then
-  enableval=$enable_xcap; enable_xcap=yes
+  enableval=$enable_xcap;
+else
+  enable_xcap=yes
 fi
 
 
