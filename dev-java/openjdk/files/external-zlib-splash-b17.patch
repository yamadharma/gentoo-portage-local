Index: openjdk-b13/j2se/make/sun/splashscreen/FILES_c.gmk
===================================================================
--- openjdk/j2se/make/sun/splashscreen/FILES_c.gmk.orig	2007-08-02 09:17:58.000000000 +0200
+++ openjdk/j2se/make/sun/splashscreen/FILES_c.gmk	2007-08-03 01:21:08.000000000 +0200
@@ -49,20 +49,6 @@
 	dgif_lib.c \
 	gif_err.c \
 	gifalloc.c \
-	compress.c \
-	deflate.c \
-	gzio.c \
-	infblock.c \
-	infcodes.c \
-	inffast.c \
-	inflate.c \
-	inftrees.c \
-	infutil.c \
-	trees.c \
-	uncompr.c \
-	zadler32.c \
-	zcrc32.c \
-	zutil.c \
 	jcomapi.c \
 	jdapimin.c \
 	jdapistd.c \
@@ -108,3 +94,19 @@
 	jfdctfst.c \
 	jfdctint.c
 
+ifneq ($(EXTERNAL_ZLIB),true)
+FILES_c += compress.c \
+	deflate.c \
+	gzio.c \
+	infblock.c \
+	infcodes.c \
+	inffast.c \
+	inflate.c \
+	inftrees.c \
+	infutil.c \
+	trees.c \
+	uncompr.c \
+	zadler32.c \
+	zcrc32.c \
+	zutil.c
+endif
Index: openjdk-b13/j2se/make/sun/splashscreen/Makefile
===================================================================
--- openjdk-b13.orig/j2se/make/sun/splashscreen/Makefile
+++ openjdk-b13/j2se/make/sun/splashscreen/Makefile
@@ -83,9 +83,15 @@ vpath %.c   $(SHARE_SRC)/native/$(PKGDIR
 vpath %.c   $(PLATFORM_SRC)/native/$(PKGDIR)/splashscreen
 
 CPPFLAGS += -I$(PLATFORM_SRC)/native/$(PKGDIR)/splashscreen -I$(SHARE_SRC)/native/$(PKGDIR)/splashscreen
-CPPFLAGS += -I$(SHARE_SRC)/native/$(PKGDIR)/image/jpeg -I$(SHARE_SRC)/native/java/util/zip/zlib-1.1.3
+CPPFLAGS += -I$(SHARE_SRC)/native/$(PKGDIR)/image/jpeg
 
 #
 # Has been converted to the JNI: generate JNI-style header files
 #
 JAVAHFLAGS += -jni
+
+ifeq ($(EXTERNAL_ZLIB), true)
+  OTHER_LDLIBS += -lz
+else
+  CPPFLAGS += -I$(SHARE_SRC)/native/java/util/zip/zlib-1.1.3
+endif
